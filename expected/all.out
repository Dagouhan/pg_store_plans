\echo ###### Prepare for the test
###### Prepare for the test
\set QUIET
SET client_min_messages = 'error';
CREATE EXTENSION IF NOT EXISTS pg_store_plans;
DROP TABLE IF EXISTS plans;
CREATE TABLE plans (id int, title text, lplan text, splan text);
SET client_min_messages = 'notice';
\set ECHO none
###### insert original JSON plans
###### set shortened JSON
UPDATE plans SET splan = pg_store_plans_shorten(lplan);
###### tag abbreviation test
SELECT splan FROM plans WHERE id = -1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                          splan                                                                                                                                                                                                                                                                                                                                                                                                                                                           
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 {"p":0,"l":0,"t":"a","t":"b","t":"c","t":"d","t":"e","t":"f","t":"g","t":"h","t":"i","t":"j","t":"k","t":"l","t":"m","t":"n","t":"o","t":"p","t":"q","t":"r","t":"s","t":"t","t":"u","t":"v","t":"w","t":"x","t":"y","t":"z","t":"0","t":"1","t":"2","t":"3","t":"4","t":"5","h":"o","h":"i","h":"s","h":"m","h":"I","h":"S","d":"b","d":"n","d":"f","i":0,"n":0,"f":0,"c":0,"s":0,"a":0,"o":"[]","m":"a","g":"p","g":"s","g":"h","j":"i","j":"l","j":"f","j":"r","j":"s","j":"a","b":"i","b":"I","b":"e","b":"E","e":"h","e":"q","e":"e","e":"E","e":"s","k":"a","5":"a","6":"a","7":"a","8":"a","9":"a","0":"a","!":"i","!":"d","!":"u","q":"a","r":0,"u":0,"v":0,"w":0,"x":0,"y":0,"1":0,"2":0,"3":0,"4":0,"A":0,"B":0,"C":0,"D":0,"E":0,"F":0,"G":0,"H":0,"I":0,"J":0,"K":0,"L":0,"M":0,"N":0,"O":0,"P":0,"Q":0,"R":0,"S":"d","S":"m","T":0,"U":0,"V":0,"W":0,"X":0,"Y":0,"Z":0,"z":0,"#":0,"$":0,"&":0,"(":0,")":0}
(1 row)

###### JSON properties round-trip test
SELECT id FROM plans
	where pg_store_plans_jsonplan(splan) <> lplan;
 id 
----
(0 rows)

###### format conversion tests
SELECT '### '||'yaml-short       '||title||E'\n'||
  pg_store_plans_yamlplan(splan)
  FROM plans WHERE id BETWEEN 1 AND 3 or id = 1 ORDER BY id;
### yaml-short       ###### Plan 1: Insert, Trigger
- Plan:
    Node Type: "ModifyTable"
    Operation: "Insert"
    Relation Name: "tt1"
    Schema: "public"
    Alias: "tt1"
    Startup Cost: 0.00
    Total Cost: 10.00
    Plan Rows: 1000
    Plan Width: 4
    Actual Startup Time: 278.971
    Actual Total Time: 278.971
    Actual Rows: 0
    Actual Loops: 1
    Shared Hit Blocks: 29735
    Shared Read Blocks: 87
    Shared Dirtied Blocks: 85
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Function Scan"
        Parent Relationship: "Member"
        Function Name: "generate_series"
        Schema: "pg_catalog"
        Alias: "a"
        Startup Cost: 0.00
        Total Cost: 10.00
        Plan Rows: 1000
        Plan Width: 4
        Actual Startup Time: 3.482
        Actual Total Time: 9.608
        Actual Rows: 10001
        Actual Loops: 1
        Output:
          - "a.a"
          - "NULL::integer"
          - "NULL::text"
        Function Call: "generate_series(0, 10000)"
        Shared Hit Blocks: 0
        Shared Read Blocks: 0
        Shared Dirtied Blocks: 0
        Shared Written Blocks: 0
        Local Hit Blocks: 0
        Local Read Blocks: 0
        Local Dirtied Blocks: 0
        Local Written Blocks: 0
        Temp Read Blocks: 0
        Temp Written Blocks: 0
        I/O Read Time: 0.000
        I/O Write Time: 0.000
  Planning Time: 0.073
  Triggers:
    - Trigger Name: "tt1_trig_1"
      Relation: "tt1"
      Time: 99.098
      Calls: 10001
    - Trigger Name: "tt1_trig_2"
      Relation: "tt1"
      Time: 87.327
      Calls: 10001
  Execution Time: 279.599

=======
### yaml-short       ###### Plan 2: Update, Trigger
- Plan:
    Node Type: "ModifyTable"
    Operation: "Update"
    Relation Name: "tt1"
    Schema: "public"
    Alias: "tt1"
    Startup Cost: 0.00
    Total Cost: 134.75
    Plan Rows: 6380
    Plan Width: 46
    Actual Startup Time: 341.462
    Actual Total Time: 341.462
    Actual Rows: 0
    Actual Loops: 1
    Shared Hit Blocks: 50276
    Shared Read Blocks: 108
    Shared Dirtied Blocks: 108
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Seq Scan"
        Parent Relationship: "Member"
        Relation Name: "tt1"
        Schema: "public"
        Alias: "tt1"
        Startup Cost: 0.00
        Total Cost: 134.75
        Plan Rows: 6380
        Plan Width: 46
        Actual Startup Time: 0.039
        Actual Total Time: 10.562
        Actual Rows: 10001
        Actual Loops: 1
        Output:
          - "(a + 1)"
          - "b"
          - "c"
          - "ctid"
        Shared Hit Blocks: 55
        Shared Read Blocks: 0
        Shared Dirtied Blocks: 0
        Shared Written Blocks: 0
        Local Hit Blocks: 0
        Local Read Blocks: 0
        Local Dirtied Blocks: 0
        Local Written Blocks: 0
        Temp Read Blocks: 0
        Temp Written Blocks: 0
        I/O Read Time: 0.000
        I/O Write Time: 0.000
  Planning Time: 0.190
  Triggers:
    - Trigger Name: "tt1_trig_1"
      Relation: "tt1"
      Time: 106.223
      Calls: 10001
    - Trigger Name: "tt1_trig_2"
      Relation: "tt1"
      Time: 89.765
      Calls: 10001
  Execution Time: 341.510

=======
### yaml-short       ###### Plan 3: Delete
- Plan:
    Node Type: "ModifyTable"
    Operation: "Delete"
    Relation Name: "tt1"
    Schema: "public"
    Alias: "tt1"
    Startup Cost: 0.00
    Total Cost: 298.66
    Plan Rows: 63
    Plan Width: 6
    Actual Startup Time: 16.121
    Actual Total Time: 16.121
    Actual Rows: 0
    Actual Loops: 1
    Shared Hit Blocks: 1109
    Shared Read Blocks: 0
    Shared Dirtied Blocks: 0
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Seq Scan"
        Parent Relationship: "Member"
        Relation Name: "tt1"
        Schema: "public"
        Alias: "tt1"
        Startup Cost: 0.00
        Total Cost: 298.66
        Plan Rows: 63
        Plan Width: 6
        Actual Startup Time: 3.838
        Actual Total Time: 9.672
        Actual Rows: 1000
        Actual Loops: 1
        Output:
          - "ctid"
        Filter: "((tt1.a % 10) = 0)"
        Rows Removed by Filter: 9001
        Shared Hit Blocks: 109
        Shared Read Blocks: 0
        Shared Dirtied Blocks: 0
        Shared Written Blocks: 0
        Local Hit Blocks: 0
        Local Read Blocks: 0
        Local Dirtied Blocks: 0
        Local Written Blocks: 0
        Temp Read Blocks: 0
        Temp Written Blocks: 0
        I/O Read Time: 0.000
        I/O Write Time: 0.000
  Planning Time: 0.151
  Triggers:
  Execution Time: 16.159
##################
SELECT '### '||'xml-short        '||title||E'\n'||
  pg_store_plans_xmlplan(splan)
  FROM plans WHERE id BETWEEN 4 AND 6 or id = 1 ORDER BY id;
### xml-short        ###### Plan 1: Insert, Trigger
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>ModifyTable</Node-Type>
      <Operation>Insert</Operation>
      <Relation-Name>tt1</Relation-Name>
      <Schema>public</Schema>
      <Alias>tt1</Alias>
      <Startup-Cost>0.00</Startup-Cost>
      <Total-Cost>10.00</Total-Cost>
      <Plan-Rows>1000</Plan-Rows>
      <Plan-Width>4</Plan-Width>
      <Actual-Startup-Time>278.971</Actual-Startup-Time>
      <Actual-Total-Time>278.971</Actual-Total-Time>
      <Actual-Rows>0</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Shared-Hit-Blocks>29735</Shared-Hit-Blocks>
      <Shared-Read-Blocks>87</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>85</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Plan>
          <Node-Type>Function Scan</Node-Type>
          <Parent-Relationship>Member</Parent-Relationship>
          <Function-Name>generate_series</Function-Name>
          <Schema>pg_catalog</Schema>
          <Alias>a</Alias>
          <Startup-Cost>0.00</Startup-Cost>
          <Total-Cost>10.00</Total-Cost>
          <Plan-Rows>1000</Plan-Rows>
          <Plan-Width>4</Plan-Width>
          <Actual-Startup-Time>3.482</Actual-Startup-Time>
          <Actual-Total-Time>9.608</Actual-Total-Time>
          <Actual-Rows>10001</Actual-Rows>
          <Actual-Loops>1</Actual-Loops>
          <Output>
            <Item>a.a</Item>
            <Item>NULL::integer</Item>
            <Item>NULL::text</Item>
          </Output>
          <Function-Call>generate_series(0, 10000)</Function-Call>
          <Shared-Hit-Blocks>0</Shared-Hit-Blocks>
          <Shared-Read-Blocks>0</Shared-Read-Blocks>
          <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
          <Shared-Written-Blocks>0</Shared-Written-Blocks>
          <Local-Hit-Blocks>0</Local-Hit-Blocks>
          <Local-Read-Blocks>0</Local-Read-Blocks>
          <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
          <Local-Written-Blocks>0</Local-Written-Blocks>
          <Temp-Read-Blocks>0</Temp-Read-Blocks>
          <Temp-Written-Blocks>0</Temp-Written-Blocks>
          <I/O-Read-Time>0.000</I/O-Read-Time>
          <I/O-Write-Time>0.000</I/O-Write-Time>
        </Plan>
      </Plans>
    </Plan>
    <Planning-Time>0.073</Planning-Time>
    <Triggers>
      <Trigger>
        <Trigger-Name>tt1_trig_1</Trigger-Name>
        <Relation>tt1</Relation>
        <Time>99.098</Time>
        <Calls>10001</Calls>
      </Trigger>
      <Trigger>
        <Trigger-Name>tt1_trig_2</Trigger-Name>
        <Relation>tt1</Relation>
        <Time>87.327</Time>
        <Calls>10001</Calls>
      </Trigger>
    </Triggers>
    <Execution-Time>279.599</Execution-Time>
  </Query>
</explain>


=======
### xml-short        ###### Plan 4: Result, Append Seq Scan
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>Result</Node-Type>
      <Startup-Cost>0.00</Startup-Cost>
      <Total-Cost>418.02</Total-Cost>
      <Plan-Rows>20002</Plan-Rows>
      <Plan-Width>8</Plan-Width>
      <Actual-Startup-Time>2.456</Actual-Startup-Time>
      <Actual-Total-Time>18.463</Actual-Total-Time>
      <Actual-Rows>20002</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Output>
        <Item>((tt1.a + 1))</Item>
        <Item>(3)</Item>
        <Item>1</Item>
      </Output>
      <Shared-Hit-Blocks>218</Shared-Hit-Blocks>
      <Shared-Read-Blocks>0</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Plan>
          <Node-Type>Append</Node-Type>
          <Parent-Relationship>Outer</Parent-Relationship>
          <Startup-Cost>0.00</Startup-Cost>
          <Total-Cost>418.02</Total-Cost>
          <Plan-Rows>20002</Plan-Rows>
          <Plan-Width>8</Plan-Width>
          <Actual-Startup-Time>2.455</Actual-Startup-Time>
          <Actual-Total-Time>13.035</Actual-Total-Time>
          <Actual-Rows>20002</Actual-Rows>
          <Actual-Loops>1</Actual-Loops>
          <Shared-Hit-Blocks>218</Shared-Hit-Blocks>
          <Shared-Read-Blocks>0</Shared-Read-Blocks>
          <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
          <Shared-Written-Blocks>0</Shared-Written-Blocks>
          <Local-Hit-Blocks>0</Local-Hit-Blocks>
          <Local-Read-Blocks>0</Local-Read-Blocks>
          <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
          <Local-Written-Blocks>0</Local-Written-Blocks>
          <Temp-Read-Blocks>0</Temp-Read-Blocks>
          <Temp-Written-Blocks>0</Temp-Written-Blocks>
          <I/O-Read-Time>0.000</I/O-Read-Time>
          <I/O-Write-Time>0.000</I/O-Write-Time>
          <Plans>
            <Plan>
              <Node-Type>Seq Scan</Node-Type>
              <Parent-Relationship>Member</Parent-Relationship>
              <Relation-Name>tt1</Relation-Name>
              <Schema>public</Schema>
              <Alias>tt1</Alias>
              <Startup-Cost>0.00</Startup-Cost>
              <Total-Cost>263.01</Total-Cost>
              <Plan-Rows>10001</Plan-Rows>
              <Plan-Width>8</Plan-Width>
              <Actual-Startup-Time>2.454</Actual-Startup-Time>
              <Actual-Total-Time>7.270</Actual-Total-Time>
              <Actual-Rows>10001</Actual-Rows>
              <Actual-Loops>1</Actual-Loops>
              <Output>
                <Item>(tt1.a + 1)</Item>
                <Item>3</Item>
              </Output>
              <Shared-Hit-Blocks>163</Shared-Hit-Blocks>
              <Shared-Read-Blocks>0</Shared-Read-Blocks>
              <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
              <Shared-Written-Blocks>0</Shared-Written-Blocks>
              <Local-Hit-Blocks>0</Local-Hit-Blocks>
              <Local-Read-Blocks>0</Local-Read-Blocks>
              <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
              <Local-Written-Blocks>0</Local-Written-Blocks>
              <Temp-Read-Blocks>0</Temp-Read-Blocks>
              <Temp-Written-Blocks>0</Temp-Written-Blocks>
              <I/O-Read-Time>0.000</I/O-Read-Time>
              <I/O-Write-Time>0.000</I/O-Write-Time>
            </Plan>
            <Plan>
              <Node-Type>Seq Scan</Node-Type>
              <Parent-Relationship>Member</Parent-Relationship>
              <Relation-Name>tt2</Relation-Name>
              <Schema>public</Schema>
              <Alias>tt2</Alias>
              <Startup-Cost>0.00</Startup-Cost>
              <Total-Cost>155.01</Total-Cost>
              <Plan-Rows>10001</Plan-Rows>
              <Plan-Width>8</Plan-Width>
              <Actual-Startup-Time>0.006</Actual-Startup-Time>
              <Actual-Total-Time>2.516</Actual-Total-Time>
              <Actual-Rows>10001</Actual-Rows>
              <Actual-Loops>1</Actual-Loops>
              <Output>
                <Item>tt2.a</Item>
                <Item>4</Item>
              </Output>
              <Shared-Hit-Blocks>55</Shared-Hit-Blocks>
              <Shared-Read-Blocks>0</Shared-Read-Blocks>
              <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
              <Shared-Written-Blocks>0</Shared-Written-Blocks>
              <Local-Hit-Blocks>0</Local-Hit-Blocks>
              <Local-Read-Blocks>0</Local-Read-Blocks>
              <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
              <Local-Written-Blocks>0</Local-Written-Blocks>
              <Temp-Read-Blocks>0</Temp-Read-Blocks>
              <Temp-Written-Blocks>0</Temp-Written-Blocks>
              <I/O-Read-Time>0.000</I/O-Read-Time>
              <I/O-Write-Time>0.000</I/O-Write-Time>
            </Plan>
          </Plans>
        </Plan>
      </Plans>
    </Plan>
    <Planning-Time>0.396</Planning-Time>
    <Triggers>
    </Triggers>
    <Execution-Time>20.432</Execution-Time>
  </Query>
</explain>


=======
### xml-short        ###### Plan 5: Index scan (forward) ANY, array in expr, escape
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>Index Scan</Node-Type>
      <Scan-Direction>Forward</Scan-Direction>
      <Index-Name>i_tt1</Index-Name>
      <Relation-Name>tt1</Relation-Name>
      <Schema>public</Schema>
      <Alias>x"y</Alias>
      <Startup-Cost>0.29</Startup-Cost>
      <Total-Cost>21.21</Total-Cost>
      <Plan-Rows>4</Plan-Rows>
      <Plan-Width>12</Plan-Width>
      <Actual-Startup-Time>0.010</Actual-Startup-Time>
      <Actual-Total-Time>0.043</Actual-Total-Time>
      <Actual-Rows>4</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Output>
        <Item>a</Item>
        <Item>b</Item>
        <Item>c</Item>
      </Output>
      <Index-Cond>("x""y".a = ANY ('{50,120,300,500}'::integer[]))</Index-Cond>
      <Rows-Removed-by-Index-Recheck>0</Rows-Removed-by-Index-Recheck>
      <Shared-Hit-Blocks>20</Shared-Hit-Blocks>
      <Shared-Read-Blocks>0</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
    </Plan>
    <Planning-Time>0.160</Planning-Time>
    <Triggers>
    </Triggers>
    <Execution-Time>0.114</Execution-Time>
  </Query>
</explain>


=======
### xml-short        ###### Plan 6: Index scan (backward), MergeJoin, Sort, quichsort, alias
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>Limit</Node-Type>
      <Startup-Cost>819.75</Startup-Cost>
      <Total-Cost>820.79</Total-Cost>
      <Plan-Rows>10</Plan-Rows>
      <Plan-Width>12</Plan-Width>
      <Actual-Startup-Time>17.722</Actual-Startup-Time>
      <Actual-Total-Time>17.722</Actual-Total-Time>
      <Actual-Rows>0</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Output>
        <Item>x.b</Item>
        <Item>x.c</Item>
        <Item>x.a</Item>
      </Output>
      <Shared-Hit-Blocks>61</Shared-Hit-Blocks>
      <Shared-Read-Blocks>0</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Plan>
          <Node-Type>Merge Join</Node-Type>
          <Parent-Relationship>Outer</Parent-Relationship>
          <Join-Type>Inner</Join-Type>
          <Startup-Cost>819.75</Startup-Cost>
          <Total-Cost>1854.80</Total-Cost>
          <Plan-Rows>10001</Plan-Rows>
          <Plan-Width>12</Plan-Width>
          <Actual-Startup-Time>17.721</Actual-Startup-Time>
          <Actual-Total-Time>17.721</Actual-Total-Time>
          <Actual-Rows>0</Actual-Rows>
          <Actual-Loops>1</Actual-Loops>
          <Output>
            <Item>x.b</Item>
            <Item>x.c</Item>
            <Item>x.a</Item>
          </Output>
          <Merge-Cond>(x.a = (((- y.b) * 3)))</Merge-Cond>
          <Shared-Hit-Blocks>61</Shared-Hit-Blocks>
          <Shared-Read-Blocks>0</Shared-Read-Blocks>
          <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
          <Shared-Written-Blocks>0</Shared-Written-Blocks>
          <Local-Hit-Blocks>0</Local-Hit-Blocks>
          <Local-Read-Blocks>0</Local-Read-Blocks>
          <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
          <Local-Written-Blocks>0</Local-Written-Blocks>
          <Temp-Read-Blocks>0</Temp-Read-Blocks>
          <Temp-Written-Blocks>0</Temp-Written-Blocks>
          <I/O-Read-Time>0.000</I/O-Read-Time>
          <I/O-Write-Time>0.000</I/O-Write-Time>
          <Plans>
            <Plan>
              <Node-Type>Index Scan</Node-Type>
              <Parent-Relationship>Outer</Parent-Relationship>
              <Scan-Direction>Backward</Scan-Direction>
              <Index-Name>i_tt1</Index-Name>
              <Relation-Name>tt1</Relation-Name>
              <Schema>public</Schema>
              <Alias>x</Alias>
              <Startup-Cost>0.29</Startup-Cost>
              <Total-Cost>760.30</Total-Cost>
              <Plan-Rows>10001</Plan-Rows>
              <Plan-Width>12</Plan-Width>
              <Actual-Startup-Time>0.030</Actual-Startup-Time>
              <Actual-Total-Time>0.030</Actual-Total-Time>
              <Actual-Rows>1</Actual-Rows>
              <Actual-Loops>1</Actual-Loops>
              <Output>
                <Item>x.a</Item>
                <Item>x.b</Item>
                <Item>x.c</Item>
              </Output>
              <Shared-Hit-Blocks>6</Shared-Hit-Blocks>
              <Shared-Read-Blocks>0</Shared-Read-Blocks>
              <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
              <Shared-Written-Blocks>0</Shared-Written-Blocks>
              <Local-Hit-Blocks>0</Local-Hit-Blocks>
              <Local-Read-Blocks>0</Local-Read-Blocks>
              <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
              <Local-Written-Blocks>0</Local-Written-Blocks>
              <Temp-Read-Blocks>0</Temp-Read-Blocks>
              <Temp-Written-Blocks>0</Temp-Written-Blocks>
              <I/O-Read-Time>0.000</I/O-Read-Time>
              <I/O-Write-Time>0.000</I/O-Write-Time>
            </Plan>
            <Plan>
              <Node-Type>Sort</Node-Type>
              <Parent-Relationship>Inner</Parent-Relationship>
              <Startup-Cost>819.47</Startup-Cost>
              <Total-Cost>844.47</Total-Cost>
              <Plan-Rows>10001</Plan-Rows>
              <Plan-Width>4</Plan-Width>
              <Actual-Startup-Time>15.127</Actual-Startup-Time>
              <Actual-Total-Time>15.873</Actual-Total-Time>
              <Actual-Rows>10001</Actual-Rows>
              <Actual-Loops>1</Actual-Loops>
              <Output>
                <Item>y.b</Item>
                <Item>(((- y.b) * 3))</Item>
              </Output>
              <Sort-Key>
                <Item>(((- y.b) * 3))</Item>
              </Sort-Key>
              <Sort-Method>quicksort</Sort-Method>
              <Sort-Space-Used>855</Sort-Space-Used>
              <Sort-Space-Type>Memory</Sort-Space-Type>
              <Shared-Hit-Blocks>55</Shared-Hit-Blocks>
              <Shared-Read-Blocks>0</Shared-Read-Blocks>
              <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
              <Shared-Written-Blocks>0</Shared-Written-Blocks>
              <Local-Hit-Blocks>0</Local-Hit-Blocks>
              <Local-Read-Blocks>0</Local-Read-Blocks>
              <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
              <Local-Written-Blocks>0</Local-Written-Blocks>
              <Temp-Read-Blocks>0</Temp-Read-Blocks>
              <Temp-Written-Blocks>0</Temp-Written-Blocks>
              <I/O-Read-Time>0.000</I/O-Read-Time>
              <I/O-Write-Time>0.000</I/O-Write-Time>
              <Plans>
                <Plan>
                  <Node-Type>Seq Scan</Node-Type>
                  <Parent-Relationship>Outer</Parent-Relationship>
                  <Relation-Name>tt2</Relation-Name>
                  <Schema>public</Schema>
                  <Alias>y</Alias>
                  <Startup-Cost>0.00</Startup-Cost>
                  <Total-Cost>155.01</Total-Cost>
                  <Plan-Rows>10001</Plan-Rows>
                  <Plan-Width>4</Plan-Width>
                  <Actual-Startup-Time>0.017</Actual-Startup-Time>
                  <Actual-Total-Time>7.124</Actual-Total-Time>
                  <Actual-Rows>10001</Actual-Rows>
                  <Actual-Loops>1</Actual-Loops>
                  <Output>
                    <Item>y.b</Item>
                    <Item>((- y.b) * 3)</Item>
                  </Output>
                  <Shared-Hit-Blocks>55</Shared-Hit-Blocks>
                  <Shared-Read-Blocks>0</Shared-Read-Blocks>
                  <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
                  <Shared-Written-Blocks>0</Shared-Written-Blocks>
                  <Local-Hit-Blocks>0</Local-Hit-Blocks>
                  <Local-Read-Blocks>0</Local-Read-Blocks>
                  <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
                  <Local-Written-Blocks>0</Local-Written-Blocks>
                  <Temp-Read-Blocks>0</Temp-Read-Blocks>
                  <Temp-Written-Blocks>0</Temp-Written-Blocks>
                  <I/O-Read-Time>0.000</I/O-Read-Time>
                  <I/O-Write-Time>0.000</I/O-Write-Time>
                </Plan>
              </Plans>
            </Plan>
          </Plans>
        </Plan>
      </Plans>
    </Plan>
    <Planning-Time>0.422</Planning-Time>
    <Triggers>
    </Triggers>
    <Execution-Time>17.968</Execution-Time>
  </Query>
</explain>

###### text format output test
SELECT '### '||'TEXT-short       '||title||E'\n'||
  pg_store_plans_textplan(splan)
  FROM plans ORDER BY id;
### TEXT-short       ###### Plan -2: all properties plus unknown key

Planning Time: 0 ms
Execution Time: 0 ms

=======
### TEXT-short       ###### Plan -1: all properties

Planning Time: 0 ms
Execution Time: 0 ms

=======
### TEXT-short       ###### Plan 1: Insert, Trigger
Insert on public.tt1  (cost=0.00..10.00 rows=1000 width=4) (actual time=278.971..278.971 rows=0 loops=1)
  Buffers: shared hit=29735 read=87 dirtied=85
  ->  Function Scan on pg_catalog.generate_series a  (cost=0.00..10.00 rows=1000 width=4) (actual time=3.482..9.608 rows=10001 loops=1)
        Output: a.a, NULL::integer, NULL::text
        Function Call: generate_series(0, 10000)
Planning Time: 0.073 ms
Trigger tt1_trig_1: time=99.098 calls=10001
Trigger tt1_trig_2: time=87.327 calls=10001
Execution Time: 279.599 ms

=======
### TEXT-short       ###### Plan 2: Update, Trigger
Update on public.tt1  (cost=0.00..134.75 rows=6380 width=46) (actual time=341.462..341.462 rows=0 loops=1)
  Buffers: shared hit=50276 read=108 dirtied=108
  ->  Seq Scan on public.tt1  (cost=0.00..134.75 rows=6380 width=46) (actual time=0.039..10.562 rows=10001 loops=1)
        Output: (a + 1), b, c, ctid
        Buffers: shared hit=55
Planning Time: 0.190 ms
Trigger tt1_trig_1: time=106.223 calls=10001
Trigger tt1_trig_2: time=89.765 calls=10001
Execution Time: 341.510 ms

=======
### TEXT-short       ###### Plan 3: Delete
Delete on public.tt1  (cost=0.00..298.66 rows=63 width=6) (actual time=16.121..16.121 rows=0 loops=1)
  Buffers: shared hit=1109
  ->  Seq Scan on public.tt1  (cost=0.00..298.66 rows=63 width=6) (actual time=3.838..9.672 rows=1000 loops=1)
        Output: ctid
        Filter: ((tt1.a % 10) = 0)
        Rows Removed by Filter: 9001
        Buffers: shared hit=109
Planning Time: 0.151 ms
Execution Time: 16.159 ms

=======
### TEXT-short       ###### Plan 4: Result, Append Seq Scan
Result  (cost=0.00..418.02 rows=20002 width=8) (actual time=2.456..18.463 rows=20002 loops=1)
  Output: ((tt1.a + 1)), (3), 1
  Buffers: shared hit=218
  ->  Append  (cost=0.00..418.02 rows=20002 width=8) (actual time=2.455..13.035 rows=20002 loops=1)
        Buffers: shared hit=218
        ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=8) (actual time=2.454..7.270 rows=10001 loops=1)
              Output: (tt1.a + 1), 3
              Buffers: shared hit=163
        ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=8) (actual time=0.006..2.516 rows=10001 loops=1)
              Output: tt2.a, 4
              Buffers: shared hit=55
Planning Time: 0.396 ms
Execution Time: 20.432 ms

=======
### TEXT-short       ###### Plan 5: Index scan (forward) ANY, array in expr, escape
Index Scan using i_tt1 on public.tt1 "x""y"  (cost=0.29..21.21 rows=4 width=12) (actual time=0.010..0.043 rows=4 loops=1)
  Output: a, b, c
  Index Cond: ("x""y".a = ANY ('{50,120,300,500}'::integer[]))
  Buffers: shared hit=20
Planning Time: 0.160 ms
Execution Time: 0.114 ms

=======
### TEXT-short       ###### Plan 6: Index scan (backward), MergeJoin, Sort, quichsort, alias
Limit  (cost=819.75..820.79 rows=10 width=12) (actual time=17.722..17.722 rows=0 loops=1)
  Output: x.b, x.c, x.a
  Buffers: shared hit=61
  ->  Merge Join  (cost=819.75..1854.80 rows=10001 width=12) (actual time=17.721..17.721 rows=0 loops=1)
        Output: x.b, x.c, x.a
        Merge Cond: (x.a = (((- y.b) * 3)))
        Buffers: shared hit=61
        ->  Index Scan Backward using i_tt1 on public.tt1 x  (cost=0.29..760.30 rows=10001 width=12) (actual time=0.030..0.030 rows=1 loops=1)
              Output: x.a, x.b, x.c
              Buffers: shared hit=6
        ->  Sort  (cost=819.47..844.47 rows=10001 width=4) (actual time=15.127..15.873 rows=10001 loops=1)
              Output: y.b, (((- y.b) * 3))
              Sort Key: (((- y.b) * 3))
              Sort Method: quicksort  Memory: 855kB
              Buffers: shared hit=55
              ->  Seq Scan on public.tt2 y  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.017..7.124 rows=10001 loops=1)
                    Output: y.b, ((- y.b) * 3)
                    Buffers: shared hit=55
Planning Time: 0.422 ms
Execution Time: 17.968 ms

=======
### TEXT-short       ###### Plan 7: IndexOnlyScan
Index Only Scan using i_tt1 on public.tt1  (cost=0.29..8.46 rows=10 width=4) (actual time=0.015..0.033 rows=10 loops=1)
  Output: a
  Index Cond: (tt1.a < 10)
  Heap Fetches: 29
  Buffers: shared hit=31
Planning Time: 0.065 ms
Execution Time: 0.049 ms

=======
### TEXT-short       ###### Plan 8: Plain Aggregate, CTE, Recursive Union, WorkTable Scan, CTE Scan
Aggregate  (cost=3.65..3.66 rows=1 width=4) (actual time=0.034..0.034 rows=1 loops=1)
  Output: sum(cte1.a)
  CTE cte1
    ->  Recursive Union  (cost=0.00..2.95 rows=31 width=4) (actual time=0.001..0.022 rows=10 loops=1)
        ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.000..0.000 rows=1 loops=1)
              Output: 1
        ->  WorkTable Scan  (cost=0.00..0.23 rows=3 width=4) (actual time=0.001..0.001 rows=1 loops=10)
              Output: (cte1_1.a + 1)
              Filter: (cte1_1.a < 10)
  ->  CTE Scan on cte1  (cost=0.00..0.62 rows=31 width=4) (actual time=0.003..0.027 rows=10 loops=1)
        Output: cte1.a
Planning Time: 0.075 ms
Execution Time: 0.072 ms

=======
### TEXT-short       ###### Plan 9: FunctionScan, Hash/HashJoin, Nested Loop
Nested Loop  (cost=1.15..2.69 rows=1 width=64) (actual time=0.052..0.054 rows=1 loops=1)
  Output: d.datname
  Buffers: shared hit=3
  ->  Hash Join  (cost=1.02..2.41 rows=1 width=4) (actual time=0.043..0.044 rows=1 loops=1)
        Output: s.datid
        Hash Cond: (s.usesysid = u.oid)
        Buffers: shared hit=1
        ->  Function Scan on pg_catalog.pg_stat_get_activity s  (cost=0.00..1.00 rows=100 width=8) (actual time=0.029..0.029 rows=1 loops=1)
              Output: s.datid, s.pid, s.usesysid, s.application_name, s.state, s.query, s.waiting, s.xact_start, s.query_start, s.backend_start, s.state_change, s.client_addr, s.client_hostname, s.client_port, s.backend_xid, s.backend_xmin
              Function Call: pg_stat_get_activity(NULL::integer)
        ->  Hash  (cost=1.01..1.01 rows=1 width=4) (actual time=0.005..0.005 rows=1 loops=1)
              Output: u.oid
              Buckets: 1024  Batches: 1  Memory Usage: 1kB
              Buffers: shared hit=1
              ->  Seq Scan on pg_catalog.pg_authid u  (cost=0.00..1.01 rows=1 width=4) (actual time=0.003..0.004 rows=1 loops=1)
                    Output: u.oid
                    Buffers: shared hit=1
  ->  Index Scan using pg_database_oid_index on pg_catalog.pg_database d  (cost=0.13..0.27 rows=1 width=68) (actual time=0.005..0.006 rows=1 loops=1)
        Output: d.datname, d.oid
        Index Cond: (d.oid = s.datid)
        Buffers: shared hit=2
Planning Time: 0.463 ms
Execution Time: 0.143 ms

=======
### TEXT-short       ###### Plan 10: MergeAppend, Values
Merge Append  (cost=0.36..985.44 rows=10004 width=4) (actual time=0.024..21.501 rows=10004 loops=1)
  Sort Key: tt1.a
  Buffers: shared hit=30069
  ->  Index Only Scan using i_tt1 on public.tt1  (cost=0.29..760.30 rows=10001 width=4) (actual time=0.013..19.370 rows=10001 loops=1)
        Output: tt1.a
        Heap Fetches: 29973
        Buffers: shared hit=30069
  ->  Sort  (cost=0.06..0.07 rows=3 width=4) (actual time=0.009..0.010 rows=3 loops=1)
        Output: "*VALUES*".column1
        Sort Key: "*VALUES*".column1
        Sort Method: quicksort  Memory: 25kB
        ->  Values Scan on "*VALUES*"  (cost=0.00..0.04 rows=3 width=4) (actual time=0.001..0.002 rows=3 loops=1)
              Output: "*VALUES*".column1
Planning Time: 0.113 ms
Execution Time: 22.775 ms

=======
### TEXT-short       ###### Plan 11: Append, HashAggregate
HashAggregate  (cost=668.04..868.06 rows=20002 width=4) (actual time=14.818..18.534 rows=20002 loops=1)
  Output: tt1.a
  Buffers: shared hit=218
  ->  Append  (cost=0.00..618.04 rows=20002 width=4) (actual time=0.093..7.837 rows=20002 loops=1)
        Buffers: shared hit=218
        ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.092..2.656 rows=10001 loops=1)
              Output: tt1.a
              Buffers: shared hit=163
        ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.007..2.497 rows=10001 loops=1)
              Output: tt2.b
              Buffers: shared hit=55
Planning Time: 0.055 ms
Execution Time: 20.497 ms

=======
### TEXT-short       ###### Plan 12: GroupAggregate
GroupAggregate  (cost=1067.47..1242.49 rows=10001 width=8) (actual time=11.010..20.888 rows=10001 loops=1)
  Output: sum(a), b
  Buffers: shared hit=163, temp read=33 written=33
  ->  Sort  (cost=1067.47..1092.47 rows=10001 width=8) (actual time=11.006..14.448 rows=10001 loops=1)
        Output: b, a
        Sort Key: tt1.b
        Sort Method: external merge  Disk: 168kB
        Buffers: shared hit=163, temp read=33 written=33
        ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=8) (actual time=0.101..2.406 rows=10001 loops=1)
              Output: b, a
              Buffers: shared hit=163
Planning Time: 0.043 ms
Execution Time: 22.187 ms

=======
### TEXT-short       ###### Plan 13: Group
Group  (cost=1067.47..1117.47 rows=10001 width=4) (actual time=10.899..18.359 rows=10001 loops=1)
  Output: b
  Buffers: shared hit=163, temp read=25 written=25
  ->  Sort  (cost=1067.47..1092.47 rows=10001 width=4) (actual time=10.898..14.260 rows=10001 loops=1)
        Output: b
        Sort Key: tt1.b
        Sort Method: external merge  Disk: 120kB
        Buffers: shared hit=163, temp read=25 written=25
        ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.092..2.408 rows=10001 loops=1)
              Output: b
              Buffers: shared hit=163
Planning Time: 0.032 ms
Execution Time: 19.300 ms

=======
### TEXT-short       ###### Plan 14: SetOp intersect, SbuqueryScan
Sort  (cost=1332.50..1357.51 rows=10001 width=4) (actual time=18.443..18.443 rows=0 loops=1)
  Output: "*SELECT* 1".a, (0)
  Sort Key: "*SELECT* 1".a
  Sort Method: quicksort  Memory: 25kB
  Buffers: shared hit=218
  ->  HashSetOp Intersect  (cost=0.00..668.04 rows=10001 width=4) (actual time=18.440..18.440 rows=0 loops=1)
        Output: "*SELECT* 1".a, (0)
        Buffers: shared hit=218
        ->  Append  (cost=0.00..618.04 rows=20002 width=4) (actual time=0.096..12.268 rows=20002 loops=1)
              Buffers: shared hit=218
              ->  Subquery Scan on "*SELECT* 1"  (cost=0.00..363.02 rows=10001 width=4) (actual time=0.096..4.961 rows=10001 loops=1)
                    Output: "*SELECT* 1".a, 0
                    Buffers: shared hit=163
                    ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.095..2.556 rows=10001 loops=1)
                          Output: tt1.a
                          Buffers: shared hit=163
              ->  Subquery Scan on "*SELECT* 2"  (cost=0.00..255.02 rows=10001 width=4) (actual time=0.007..4.645 rows=10001 loops=1)
                    Output: "*SELECT* 2".b, 1
                    Buffers: shared hit=55
                    ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.007..2.398 rows=10001 loops=1)
                          Output: tt2.b
                          Buffers: shared hit=55
Planning Time: 0.066 ms
Execution Time: 18.676 ms

=======
### TEXT-short       ###### Plan 15: Sorted SetOp, Sort on Disk
SetOp Intersect  (cost=2323.47..2423.48 rows=10001 width=4) (actual time=46.670..46.670 rows=0 loops=1)
  Output: "*SELECT* 1".a, (0)
  Buffers: shared hit=218, temp read=77 written=77
  ->  Sort  (cost=2323.47..2373.47 rows=20002 width=4) (actual time=34.600..40.460 rows=20002 loops=1)
        Output: "*SELECT* 1".a, (0)
        Sort Key: "*SELECT* 1".a
        Sort Method: external merge  Disk: 352kB
        Buffers: shared hit=218, temp read=77 written=77
        ->  Append  (cost=0.00..618.04 rows=20002 width=4) (actual time=0.103..13.633 rows=20002 loops=1)
              Buffers: shared hit=218
              ->  Subquery Scan on "*SELECT* 1"  (cost=0.00..363.02 rows=10001 width=4) (actual time=0.103..5.850 rows=10001 loops=1)
                    Output: "*SELECT* 1".a, 0
                    Buffers: shared hit=163
                    ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.102..3.004 rows=10001 loops=1)
                          Output: tt1.a
                          Buffers: shared hit=163
              ->  Subquery Scan on "*SELECT* 2"  (cost=0.00..255.02 rows=10001 width=4) (actual time=0.007..4.912 rows=10001 loops=1)
                    Output: "*SELECT* 2".b, 1
                    Buffers: shared hit=55
                    ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.007..2.538 rows=10001 loops=1)
                          Output: tt2.b
                          Buffers: shared hit=55
Planning Time: 0.073 ms
Execution Time: 46.811 ms

=======
### TEXT-short       ###### Plan 16: HashSetOp intersect All, SubqueryScan
Sort  (cost=1332.50..1357.51 rows=10001 width=4) (actual time=18.707..18.707 rows=0 loops=1)
  Output: "*SELECT* 1".a, (0)
  Sort Key: "*SELECT* 1".a
  Sort Method: quicksort  Memory: 25kB
  Buffers: shared hit=218
  ->  HashSetOp Intersect All  (cost=0.00..668.04 rows=10001 width=4) (actual time=18.704..18.704 rows=0 loops=1)
        Output: "*SELECT* 1".a, (0)
        Buffers: shared hit=218
        ->  Append  (cost=0.00..618.04 rows=20002 width=4) (actual time=0.106..12.494 rows=20002 loops=1)
              Buffers: shared hit=218
              ->  Subquery Scan on "*SELECT* 1"  (cost=0.00..363.02 rows=10001 width=4) (actual time=0.106..5.120 rows=10001 loops=1)
                    Output: "*SELECT* 1".a, 0
                    Buffers: shared hit=163
                    ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.105..2.438 rows=10001 loops=1)
                          Output: tt1.a
                          Buffers: shared hit=163
              ->  Subquery Scan on "*SELECT* 2"  (cost=0.00..255.02 rows=10001 width=4) (actual time=0.008..4.613 rows=10001 loops=1)
                    Output: "*SELECT* 2".b, 1
                    Buffers: shared hit=55
                    ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.007..2.387 rows=10001 loops=1)
                          Output: tt2.b
                          Buffers: shared hit=55
Planning Time: 0.077 ms
Execution Time: 18.940 ms

=======
### TEXT-short       ###### Plan 17: HashSetOp except, SubqueryScan
Sort  (cost=1332.50..1357.51 rows=10001 width=4) (actual time=24.004..24.864 rows=10001 loops=1)
  Output: "*SELECT* 1".a, (0)
  Sort Key: "*SELECT* 1".a
  Sort Method: quicksort  Memory: 855kB
  Buffers: shared hit=218
  ->  HashSetOp Except  (cost=0.00..668.04 rows=10001 width=4) (actual time=18.469..19.564 rows=10001 loops=1)
        Output: "*SELECT* 1".a, (0)
        Buffers: shared hit=218
        ->  Append  (cost=0.00..618.04 rows=20002 width=4) (actual time=0.108..12.635 rows=20002 loops=1)
              Buffers: shared hit=218
              ->  Subquery Scan on "*SELECT* 1"  (cost=0.00..363.02 rows=10001 width=4) (actual time=0.108..5.319 rows=10001 loops=1)
                    Output: "*SELECT* 1".a, 0
                    Buffers: shared hit=163
                    ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.107..2.706 rows=10001 loops=1)
                          Output: tt1.a
                          Buffers: shared hit=163
              ->  Subquery Scan on "*SELECT* 2"  (cost=0.00..255.02 rows=10001 width=4) (actual time=0.006..4.610 rows=10001 loops=1)
                    Output: "*SELECT* 2".b, 1
                    Buffers: shared hit=55
                    ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.006..2.359 rows=10001 loops=1)
                          Output: tt2.b
                          Buffers: shared hit=55
Planning Time: 0.067 ms
Execution Time: 26.764 ms

=======
### TEXT-short       ###### Plan 18: HashSetOp except all, SubqueryScan
Sort  (cost=1332.50..1357.51 rows=10001 width=4) (actual time=23.660..24.524 rows=10001 loops=1)
  Output: "*SELECT* 1".a, (0)
  Sort Key: "*SELECT* 1".a
  Sort Method: quicksort  Memory: 855kB
  Buffers: shared hit=218
  ->  HashSetOp Except All  (cost=0.00..668.04 rows=10001 width=4) (actual time=18.396..19.526 rows=10001 loops=1)
        Output: "*SELECT* 1".a, (0)
        Buffers: shared hit=218
        ->  Append  (cost=0.00..618.04 rows=20002 width=4) (actual time=0.149..12.539 rows=20002 loops=1)
              Buffers: shared hit=218
              ->  Subquery Scan on "*SELECT* 1"  (cost=0.00..363.02 rows=10001 width=4) (actual time=0.148..5.230 rows=10001 loops=1)
                    Output: "*SELECT* 1".a, 0
                    Buffers: shared hit=163
                    ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.148..2.618 rows=10001 loops=1)
                          Output: tt1.a
                          Buffers: shared hit=163
              ->  Subquery Scan on "*SELECT* 2"  (cost=0.00..255.02 rows=10001 width=4) (actual time=0.007..4.628 rows=10001 loops=1)
                    Output: "*SELECT* 2".b, 1
                    Buffers: shared hit=55
                    ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.007..2.358 rows=10001 loops=1)
                          Output: tt2.b
                          Buffers: shared hit=55
Planning Time: 0.066 ms
Execution Time: 26.439 ms

=======
### TEXT-short       ###### Plan 19: merge LEFT join
Merge Left Join  (cost=0.71..4271.17 rows=33467 width=4) (actual time=0.033..57.646 rows=60003 loops=1)
  Output: x.b
  Merge Cond: (x.a = y.a)
  Buffers: shared hit=20942
  ->  Index Scan using i_tt1 on public.tt1 x  (cost=0.29..760.30 rows=10001 width=8) (actual time=0.007..4.046 rows=10001 loops=1)
        Output: x.a, x.b, x.c
        Buffers: shared hit=165
  ->  Index Only Scan using i_tt3_a on public.tt3 y  (cost=0.42..9037.06 rows=180003 width=4) (actual time=0.021..30.164 rows=60004 loops=1)
        Output: y.a
        Heap Fetches: 60004
        Buffers: shared hit=20777
Planning Time: 0.392 ms
Execution Time: 62.836 ms

=======
### TEXT-short       ###### Plan 20: hash FULL join
Hash Full Join  (cost=280.02..793.06 rows=10001 width=4) (actual time=12.175..21.075 rows=17001 loops=1)
  Output: x.b
  Hash Cond: (x.a = y.a)
  Buffers: shared hit=218
  ->  Seq Scan on public.tt1 x  (cost=0.00..263.01 rows=10001 width=8) (actual time=0.205..2.002 rows=10001 loops=1)
        Output: x.a, x.b, x.c
        Buffers: shared hit=163
  ->  Hash  (cost=155.01..155.01 rows=10001 width=4) (actual time=11.960..11.960 rows=10001 loops=1)
        Output: y.a
        Buckets: 1024  Batches: 1  Memory Usage: 352kB
        Buffers: shared hit=55
        ->  Seq Scan on public.tt2 y  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.019..5.607 rows=10001 loops=1)
              Output: y.a
              Buffers: shared hit=55
Planning Time: 0.189 ms
Execution Time: 22.756 ms

=======
### TEXT-short       ###### Plan 21: hash SEMI join
Hash Semi Join  (cost=280.02..793.06 rows=10001 width=12) (actual time=10.101..10.101 rows=0 loops=1)
  Output: tt1.a, tt1.b, tt1.c
  Hash Cond: (tt1.a = tt2.b)
  Buffers: shared hit=218
  ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=12) (actual time=0.090..1.342 rows=10001 loops=1)
        Output: tt1.a, tt1.b, tt1.c
        Buffers: shared hit=163
  ->  Hash  (cost=155.01..155.01 rows=10001 width=4) (actual time=5.481..5.481 rows=10001 loops=1)
        Output: tt2.b
        Buckets: 1024  Batches: 1  Memory Usage: 352kB
        Buffers: shared hit=55
        ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.007..2.619 rows=10001 loops=1)
              Output: tt2.b
              Buffers: shared hit=55
Planning Time: 0.184 ms
Execution Time: 10.305 ms

=======
### TEXT-short       ###### Plan 22: Hash Anti Join
Hash Anti Join  (cost=280.02..693.05 rows=1 width=12) (actual time=5.601..11.876 rows=10001 loops=1)
  Output: tt1.a, tt1.b, tt1.c
  Hash Cond: (tt1.a = tt2.b)
  Buffers: shared hit=218
  ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=12) (actual time=0.091..1.500 rows=10001 loops=1)
        Output: tt1.a, tt1.b, tt1.c
        Buffers: shared hit=163
  ->  Hash  (cost=155.01..155.01 rows=10001 width=4) (actual time=5.505..5.505 rows=10001 loops=1)
        Output: tt2.b
        Buckets: 1024  Batches: 1  Memory Usage: 352kB
        Buffers: shared hit=55
        ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.006..2.610 rows=10001 loops=1)
              Output: tt2.b
              Buffers: shared hit=55
Planning Time: 0.138 ms
Execution Time: 12.814 ms

=======
### TEXT-short       ###### Plan 23: WindowAgg
WindowAgg  (cost=927.47..1127.49 rows=10001 width=4) (actual time=5.695..16.316 rows=10001 loops=1)
  Output: first_value(a) OVER (?), ((a / 10))
  Buffers: shared hit=163
  ->  Sort  (cost=927.47..952.47 rows=10001 width=4) (actual time=5.688..6.679 rows=10001 loops=1)
        Output: ((a / 10)), a
        Sort Key: ((tt1.a / 10))
        Sort Method: quicksort  Memory: 855kB
        Buffers: shared hit=163
        ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.094..3.070 rows=10001 loops=1)
              Output: (a / 10), a
              Buffers: shared hit=163
Planning Time: 0.052 ms
Execution Time: 17.627 ms

=======
### TEXT-short       ###### Plan 24: Unique
Unique  (cost=0.29..785.30 rows=10001 width=4) (actual time=0.010..7.693 rows=10001 loops=1)
  Output: a
  Buffers: shared hit=165
  ->  Index Only Scan using i_tt1 on public.tt1  (cost=0.29..760.30 rows=10001 width=4) (actual time=0.009..4.050 rows=10001 loops=1)
        Output: a
        Heap Fetches: 10001
        Buffers: shared hit=165
Planning Time: 0.057 ms
Execution Time: 8.567 ms

=======
### TEXT-short       ###### Plan 25: PlainAggregate
Aggregate  (cost=288.01..288.02 rows=1 width=4) (actual time=3.302..3.302 rows=1 loops=1)
  Output: sum(a)
  Buffers: shared hit=163
  ->  Seq Scan on public.tt1  (cost=0.00..263.01 rows=10001 width=4) (actual time=0.094..1.500 rows=10001 loops=1)
        Output: a, b, c
        Buffers: shared hit=163
Planning Time: 0.033 ms
Execution Time: 3.325 ms

=======
### TEXT-short       ###### Plan 26: BitmapIndexScan/BitmapHeapScan, BitmapOr, lossy
Bitmap Heap Scan on public.tt3  (cost=4255.43..7478.44 rows=180001 width=12) (actual time=27.298..65.241 rows=180000 loops=1)
  Output: a, b, c
  Recheck Cond: (tt3.b > (-99998))
  Rows Removed by Index Recheck: 3
  Heap Blocks: exact=558 lossy=415
  Buffers: shared hit=1686
  ->  Bitmap Index Scan using i_tt3_b  (cost=0.00..4210.43 rows=180001 width=0) (actual time=27.185..27.185 rows=180000 loops=1)
        Index Cond: (tt3.b > (-99998))
        Buffers: shared hit=713
Planning Time: 0.101 ms
Execution Time: 78.996 ms

=======
### TEXT-short       ###### Plan 27: Join Filter
Limit  (cost=0.00..21.52 rows=100 width=12) (actual time=5.307..5.431 rows=100 loops=1)
  Output: tt2.a, tt2.b, tt2.c
  Buffers: shared hit=40, temp written=12
  ->  Nested Loop  (cost=0.00..43048282.11 rows=200023334 width=12) (actual time=5.306..5.414 rows=100 loops=1)
        Output: tt2.a, tt2.b, tt2.c
        Join Filter: ((tt2.a < tt3.a) AND ((tt3.a + tt2.a) < 100000))
        Rows Removed by Join Filter: 7001
        Buffers: shared hit=40, temp written=12
        ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=12) (actual time=0.009..0.009 rows=1 loops=1)
              Output: tt2.a, tt2.b, tt2.c
              Buffers: shared hit=1
        ->  Materialize  (cost=0.00..4377.05 rows=180003 width=4) (actual time=0.010..4.185 rows=7101 loops=1)
              Output: tt3.a
              Buffers: shared hit=39, temp written=12
              ->  Seq Scan on public.tt3  (cost=0.00..2773.03 rows=180003 width=4) (actual time=0.008..1.689 rows=7101 loops=1)
                    Output: tt3.a
                    Buffers: shared hit=39
Planning Time: 0.171 ms
Execution Time: 5.538 ms

=======
### TEXT-short       ###### Plan 28: TidScan
Tid Scan on public.tt3  (cost=0.00..4.01 rows=1 width=12) (actual time=0.004..0.004 rows=1 loops=1)
  Output: a, b, c
  Tid Cond: (tt3.ctid = '(0,28)'::tid)
  Buffers: shared hit=1
Planning Time: 0.070 ms
Execution Time: 0.017 ms

=======
### TEXT-short       ###### Plan 29: LockRows
LockRows  (cost=0.00..313.51 rows=50 width=10) (actual time=0.153..5.178 rows=1001 loops=1)
  Output: a, ctid
  Buffers: shared hit=1164
  ->  Seq Scan on public.tt1  (cost=0.00..313.01 rows=50 width=10) (actual time=0.141..3.714 rows=1001 loops=1)
        Output: a, ctid
        Filter: ((tt1.a % 10) = 0)
        Rows Removed by Filter: 9000
        Buffers: shared hit=163
Planning Time: 0.041 ms
Execution Time: 5.344 ms

=======
### TEXT-short       ###### Plan 30: Materialize
Seq Scan on public.tt1  (cost=0.00..1150490.52 rows=5000 width=12) (actual time=5.697..5.697 rows=0 loops=1)
  Output: tt1.a, tt1.b, tt1.c
  Filter: (SubPlan 1)
  Rows Removed by Filter: 10001
  Buffers: shared hit=164
  SubPlan 1
    ->  Materialize  (cost=0.00..205.01 rows=10001 width=4) (actual time=0.000..0.000 rows=1 loops=10001)
          Output: tt2.b
          Buffers: shared hit=1
        ->  Seq Scan on public.tt2  (cost=0.00..155.01 rows=10001 width=4) (actual time=0.008..0.008 rows=1 loops=1)
              Output: tt2.b
              Buffers: shared hit=1
Planning Time: 0.060 ms
Execution Time: 5.723 ms
###### long-json-as-a-source test
SELECT '### '||'yaml-long JSON   '||title||E'\n'||
  pg_store_plans_yamlplan(lplan)
  FROM plans WHERE id = 1 ORDER BY id;
### yaml-long JSON   ###### Plan 1: Insert, Trigger
- Plan:
    Node Type: "ModifyTable"
    Operation: "Insert"
    Relation Name: "tt1"
    Schema: "public"
    Alias: "tt1"
    Startup Cost: 0.00
    Total Cost: 10.00
    Plan Rows: 1000
    Plan Width: 4
    Actual Startup Time: 278.971
    Actual Total Time: 278.971
    Actual Rows: 0
    Actual Loops: 1
    Shared Hit Blocks: 29735
    Shared Read Blocks: 87
    Shared Dirtied Blocks: 85
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Function Scan"
        Parent Relationship: "Member"
        Function Name: "generate_series"
        Schema: "pg_catalog"
        Alias: "a"
        Startup Cost: 0.00
        Total Cost: 10.00
        Plan Rows: 1000
        Plan Width: 4
        Actual Startup Time: 3.482
        Actual Total Time: 9.608
        Actual Rows: 10001
        Actual Loops: 1
        Output:
          - "a.a"
          - "NULL::integer"
          - "NULL::text"
        Function Call: "generate_series(0, 10000)"
        Shared Hit Blocks: 0
        Shared Read Blocks: 0
        Shared Dirtied Blocks: 0
        Shared Written Blocks: 0
        Local Hit Blocks: 0
        Local Read Blocks: 0
        Local Dirtied Blocks: 0
        Local Written Blocks: 0
        Temp Read Blocks: 0
        Temp Written Blocks: 0
        I/O Read Time: 0.000
        I/O Write Time: 0.000
  Planning Time: 0.073
  Triggers:
    - Trigger Name: "tt1_trig_1"
      Relation: "tt1"
      Time: 99.098
      Calls: 10001
    - Trigger Name: "tt1_trig_2"
      Relation: "tt1"
      Time: 87.327
      Calls: 10001
  Execution Time: 279.599
##################
SELECT '### '||'xml-long JSON    '||title||E'\n'||
  pg_store_plans_xmlplan(lplan)
  FROM plans WHERE id = 1 ORDER BY id;
### xml-long JSON    ###### Plan 1: Insert, Trigger
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>ModifyTable</Node-Type>
      <Operation>Insert</Operation>
      <Relation-Name>tt1</Relation-Name>
      <Schema>public</Schema>
      <Alias>tt1</Alias>
      <Startup-Cost>0.00</Startup-Cost>
      <Total-Cost>10.00</Total-Cost>
      <Plan-Rows>1000</Plan-Rows>
      <Plan-Width>4</Plan-Width>
      <Actual-Startup-Time>278.971</Actual-Startup-Time>
      <Actual-Total-Time>278.971</Actual-Total-Time>
      <Actual-Rows>0</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Shared-Hit-Blocks>29735</Shared-Hit-Blocks>
      <Shared-Read-Blocks>87</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>85</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Item>
          <Node-Type>Function Scan</Node-Type>
          <Parent-Relationship>Member</Parent-Relationship>
          <Function-Name>generate_series</Function-Name>
          <Schema>pg_catalog</Schema>
          <Alias>a</Alias>
          <Startup-Cost>0.00</Startup-Cost>
          <Total-Cost>10.00</Total-Cost>
          <Plan-Rows>1000</Plan-Rows>
          <Plan-Width>4</Plan-Width>
          <Actual-Startup-Time>3.482</Actual-Startup-Time>
          <Actual-Total-Time>9.608</Actual-Total-Time>
          <Actual-Rows>10001</Actual-Rows>
          <Actual-Loops>1</Actual-Loops>
          <Output>
            <Item>a.a</Item>
            <Item>NULL::integer</Item>
            <Item>NULL::text</Item>
          </Output>
          <Function-Call>generate_series(0, 10000)</Function-Call>
          <Shared-Hit-Blocks>0</Shared-Hit-Blocks>
          <Shared-Read-Blocks>0</Shared-Read-Blocks>
          <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
          <Shared-Written-Blocks>0</Shared-Written-Blocks>
          <Local-Hit-Blocks>0</Local-Hit-Blocks>
          <Local-Read-Blocks>0</Local-Read-Blocks>
          <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
          <Local-Written-Blocks>0</Local-Written-Blocks>
          <Temp-Read-Blocks>0</Temp-Read-Blocks>
          <Temp-Written-Blocks>0</Temp-Written-Blocks>
          <I/O-Read-Time>0.000</I/O-Read-Time>
          <I/O-Write-Time>0.000</I/O-Write-Time>
        </Item>
      </Plans>
    </Plan>
    <Planning-Time>0.073</Planning-Time>
    <Triggers>
      <Item>
        <Trigger-Name>tt1_trig_1</Trigger-Name>
        <Relation>tt1</Relation>
        <Time>99.098</Time>
        <Calls>10001</Calls>
      </Item>
      <Item>
        <Trigger-Name>tt1_trig_2</Trigger-Name>
        <Relation>tt1</Relation>
        <Time>87.327</Time>
        <Calls>10001</Calls>
      </Item>
    </Triggers>
    <Execution-Time>279.599</Execution-Time>
  </Query>
</explain>

##################
SELECT '### '||'text-long JSON   '||title||E'\n'||
  pg_store_plans_xmlplan(lplan)
  FROM plans WHERE id = 1 ORDER BY id;
### text-long JSON   ###### Plan 1: Insert, Trigger
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>ModifyTable</Node-Type>
      <Operation>Insert</Operation>
      <Relation-Name>tt1</Relation-Name>
      <Schema>public</Schema>
      <Alias>tt1</Alias>
      <Startup-Cost>0.00</Startup-Cost>
      <Total-Cost>10.00</Total-Cost>
      <Plan-Rows>1000</Plan-Rows>
      <Plan-Width>4</Plan-Width>
      <Actual-Startup-Time>278.971</Actual-Startup-Time>
      <Actual-Total-Time>278.971</Actual-Total-Time>
      <Actual-Rows>0</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Shared-Hit-Blocks>29735</Shared-Hit-Blocks>
      <Shared-Read-Blocks>87</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>85</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Item>
          <Node-Type>Function Scan</Node-Type>
          <Parent-Relationship>Member</Parent-Relationship>
          <Function-Name>generate_series</Function-Name>
          <Schema>pg_catalog</Schema>
          <Alias>a</Alias>
          <Startup-Cost>0.00</Startup-Cost>
          <Total-Cost>10.00</Total-Cost>
          <Plan-Rows>1000</Plan-Rows>
          <Plan-Width>4</Plan-Width>
          <Actual-Startup-Time>3.482</Actual-Startup-Time>
          <Actual-Total-Time>9.608</Actual-Total-Time>
          <Actual-Rows>10001</Actual-Rows>
          <Actual-Loops>1</Actual-Loops>
          <Output>
            <Item>a.a</Item>
            <Item>NULL::integer</Item>
            <Item>NULL::text</Item>
          </Output>
          <Function-Call>generate_series(0, 10000)</Function-Call>
          <Shared-Hit-Blocks>0</Shared-Hit-Blocks>
          <Shared-Read-Blocks>0</Shared-Read-Blocks>
          <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
          <Shared-Written-Blocks>0</Shared-Written-Blocks>
          <Local-Hit-Blocks>0</Local-Hit-Blocks>
          <Local-Read-Blocks>0</Local-Read-Blocks>
          <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
          <Local-Written-Blocks>0</Local-Written-Blocks>
          <Temp-Read-Blocks>0</Temp-Read-Blocks>
          <Temp-Written-Blocks>0</Temp-Written-Blocks>
          <I/O-Read-Time>0.000</I/O-Read-Time>
          <I/O-Write-Time>0.000</I/O-Write-Time>
        </Item>
      </Plans>
    </Plan>
    <Planning-Time>0.073</Planning-Time>
    <Triggers>
      <Item>
        <Trigger-Name>tt1_trig_1</Trigger-Name>
        <Relation>tt1</Relation>
        <Time>99.098</Time>
        <Calls>10001</Calls>
      </Item>
      <Item>
        <Trigger-Name>tt1_trig_2</Trigger-Name>
        <Relation>tt1</Relation>
        <Time>87.327</Time>
        <Calls>10001</Calls>
      </Item>
    </Triggers>
    <Execution-Time>279.599</Execution-Time>
  </Query>
</explain>

###### chopped-source test
SELECT '### '||'inflate-chopped  '||title||E'\n'||
  pg_store_plans_jsonplan(substring(splan from 1 for char_length(splan) / 3))
  FROM plans WHERE id BETWEEN 16 AND 18 ORDER BY id;
### inflate-chopped  ###### Plan 16: HashSetOp intersect All, SubqueryScan
{
  "Plan": {
    "Node Type": "Sort",
    "Startup Cost": 1332.50,
    "Total Cost": 1357.51,
    "Plan Rows": 10001,
    "Plan Width": 4,
    "Actual Startup Time": 18.707,
    "Actual Total Time": 18.707,
    "Actual Rows": 0,
    "Actual Loops": 1,
    "Output": ["\"*SELECT* 1\".a", "(0)"],
    "Sort Key": ["\"*SELECT* 1\".a"],
    "Sort Method": "quicksort",
    "Sort Space Used": 25,
    "Sort Space Type": "Memory",
    "Shared Hit Blocks": 218,
    "Shared Read Blocks": 0,
    "Shared Dirtied Blocks": 0,
    "Shared Written Blocks": 0,
    "Local Hit Blocks": 0,
    "Local Read Blocks": 0,
    "Local Dirtied Blocks": 0,
    "Local Written Blocks": 0,
    "Temp Read Blocks": 0,
    "Temp Written Blocks": 0,
    "I/O Read Time": 0.000,
    "I/O Write Time": 0.000,
    "Plans": [
      {
        "Node Type": "SetOp",
        "Strategy": "Hashed",
        "Parent Relationship": "Outer",
        "Command": "Intersect All",
        "Startup Cost": 0.00,
        "Total Cost": 668.04,
        "Plan Rows": 10001,
        "Plan Width": 4,
        "Actual Startup Time": 18.704,
        "Actual Total Time": 18.704,
        "Actual Rows": 0,
        "Actual Loops": 1,
        "Output": ["\"*SELECT* 1\".a", "(0)"],
        "Shared Hit Blocks": 218,
        "Shared Read Blocks": 0,
        "Shared Dirtied Blocks": 0,
        "Shared Written Blocks": 0,
        "Local Hit Blocks": 0,
        "Local Read Blocks": 0,
        "Local Dirtied Blocks": 0,
        "Local Written Blocks": 0,
        "Temp Read Blocks": 0,
        "Temp Written Blocks": 0,
        "I/O Read Time": 0.000,
        "I/O Write Time": 0.000,
        "Plans": [
          {
            "Node Type": "Append",
            "Parent Relationship": "Outer",
            "Startup Cost": 0.00,
            "Total Cost": 618.04,
            "Plan Rows": 20002
<truncated>

=======
### inflate-chopped  ###### Plan 17: HashSetOp except, SubqueryScan
{
  "Plan": {
    "Node Type": "Sort",
    "Startup Cost": 1332.50,
    "Total Cost": 1357.51,
    "Plan Rows": 10001,
    "Plan Width": 4,
    "Actual Startup Time": 24.004,
    "Actual Total Time": 24.864,
    "Actual Rows": 10001,
    "Actual Loops": 1,
    "Output": ["\"*SELECT* 1\".a", "(0)"],
    "Sort Key": ["\"*SELECT* 1\".a"],
    "Sort Method": "quicksort",
    "Sort Space Used": 855,
    "Sort Space Type": "Memory",
    "Shared Hit Blocks": 218,
    "Shared Read Blocks": 0,
    "Shared Dirtied Blocks": 0,
    "Shared Written Blocks": 0,
    "Local Hit Blocks": 0,
    "Local Read Blocks": 0,
    "Local Dirtied Blocks": 0,
    "Local Written Blocks": 0,
    "Temp Read Blocks": 0,
    "Temp Written Blocks": 0,
    "I/O Read Time": 0.000,
    "I/O Write Time": 0.000,
    "Plans": [
      {
        "Node Type": "SetOp",
        "Strategy": "Hashed",
        "Parent Relationship": "Outer",
        "Command": "Except",
        "Startup Cost": 0.00,
        "Total Cost": 668.04,
        "Plan Rows": 10001,
        "Plan Width": 4,
        "Actual Startup Time": 18.469,
        "Actual Total Time": 19.564,
        "Actual Rows": 10001,
        "Actual Loops": 1,
        "Output": ["\"*SELECT* 1\".a", "(0)"],
        "Shared Hit Blocks": 218,
        "Shared Read Blocks": 0,
        "Shared Dirtied Blocks": 0,
        "Shared Written Blocks": 0,
        "Local Hit Blocks": 0,
        "Local Read Blocks": 0,
        "Local Dirtied Blocks": 0,
        "Local Written Blocks": 0,
        "Temp Read Blocks": 0,
        "Temp Written Blocks": 0,
        "I/O Read Time": 0.000,
        "I/O Write Time": 0.000,
        "Plans": [
          {
            "Node Type": "Append",
            "Parent Relationship": "Outer",
            "Startup Cost": 0.00,
            "Total Cost": 618.04,
            "Plan Rows": 2
<truncated>

=======
### inflate-chopped  ###### Plan 18: HashSetOp except all, SubqueryScan
{
  "Plan": {
    "Node Type": "Sort",
    "Startup Cost": 1332.50,
    "Total Cost": 1357.51,
    "Plan Rows": 10001,
    "Plan Width": 4,
    "Actual Startup Time": 23.660,
    "Actual Total Time": 24.524,
    "Actual Rows": 10001,
    "Actual Loops": 1,
    "Output": ["\"*SELECT* 1\".a", "(0)"],
    "Sort Key": ["\"*SELECT* 1\".a"],
    "Sort Method": "quicksort",
    "Sort Space Used": 855,
    "Sort Space Type": "Memory",
    "Shared Hit Blocks": 218,
    "Shared Read Blocks": 0,
    "Shared Dirtied Blocks": 0,
    "Shared Written Blocks": 0,
    "Local Hit Blocks": 0,
    "Local Read Blocks": 0,
    "Local Dirtied Blocks": 0,
    "Local Written Blocks": 0,
    "Temp Read Blocks": 0,
    "Temp Written Blocks": 0,
    "I/O Read Time": 0.000,
    "I/O Write Time": 0.000,
    "Plans": [
      {
        "Node Type": "SetOp",
        "Strategy": "Hashed",
        "Parent Relationship": "Outer",
        "Command": "Except All",
        "Startup Cost": 0.00,
        "Total Cost": 668.04,
        "Plan Rows": 10001,
        "Plan Width": 4,
        "Actual Startup Time": 18.396,
        "Actual Total Time": 19.526,
        "Actual Rows": 10001,
        "Actual Loops": 1,
        "Output": ["\"*SELECT* 1\".a", "(0)"],
        "Shared Hit Blocks": 218,
        "Shared Read Blocks": 0,
        "Shared Dirtied Blocks": 0,
        "Shared Written Blocks": 0,
        "Local Hit Blocks": 0,
        "Local Read Blocks": 0,
        "Local Dirtied Blocks": 0,
        "Local Written Blocks": 0,
        "Temp Read Blocks": 0,
        "Temp Written Blocks": 0,
        "I/O Read Time": 0.000,
        "I/O Write Time": 0.000,
        "Plans": [
          {
            "Node Type": "Append",
            "Parent Relationship": "Outer",
            "Startup Cost": 0.00,
            "Total Cost": 618.04,
            "Plan Rows": 2
<truncated>
##################
SELECT '### '||'yaml-chopped     '||title||E'\n'||
  pg_store_plans_yamlplan(substring(splan from 1 for char_length(splan) / 3))
  FROM plans WHERE id BETWEEN 19 AND 21 ORDER BY id;
### yaml-chopped     ###### Plan 19: merge LEFT join
- Plan:
    Node Type: "Merge Join"
    Join Type: "Left"
    Startup Cost: 0.71
    Total Cost: 4271.17
    Plan Rows: 33467
    Plan Width: 4
    Actual Startup Time: 0.033
    Actual Total Time: 57.646
    Actual Rows: 60003
    Actual Loops: 1
    Output:
      - "x.b"
    Merge Cond: "(x.a = y.a)"
    Shared Hit Blocks: 20942
    Shared Read Blocks: 0
    Shared Dirtied Blocks: 0
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Index Scan"
        Parent Relationship: "Outer"
        Scan Direction: "Forward"
<truncated>

=======
### yaml-chopped     ###### Plan 20: hash FULL join
- Plan:
    Node Type: "Hash Join"
    Join Type: "Full"
    Startup Cost: 280.02
    Total Cost: 793.06
    Plan Rows: 10001
    Plan Width: 4
    Actual Startup Time: 12.175
    Actual Total Time: 21.075
    Actual Rows: 17001
    Actual Loops: 1
    Output:
      - "x.b"
    Hash Cond: "(x.a = y.a)"
    Shared Hit Blocks: 218
    Shared Read Blocks: 0
    Shared Dirtied Blocks: 0
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Seq Scan"
        Parent Relationship: "Outer"
        Relation Name: "tt1"
        Schema: "public"
        Alias: "x"
        Startup Cost: 0.00
        Total Cost: 263.01
        Plan Rows: 10001
        Plan Width: 8
<truncated>

=======
### yaml-chopped     ###### Plan 21: hash SEMI join
- Plan:
    Node Type: "Hash Join"
    Join Type: "Semi"
    Startup Cost: 280.02
    Total Cost: 793.06
    Plan Rows: 10001
    Plan Width: 12
    Actual Startup Time: 10.101
    Actual Total Time: 10.101
    Actual Rows: 0
    Actual Loops: 1
    Output:
      - "tt1.a"
      - "tt1.b"
      - "tt1.c"
    Hash Cond: "(tt1.a = tt2.b)"
    Shared Hit Blocks: 218
    Shared Read Blocks: 0
    Shared Dirtied Blocks: 0
    Shared Written Blocks: 0
    Local Hit Blocks: 0
    Local Read Blocks: 0
    Local Dirtied Blocks: 0
    Local Written Blocks: 0
    Temp Read Blocks: 0
    Temp Written Blocks: 0
    I/O Read Time: 0.000
    I/O Write Time: 0.000
    Plans:
      - Node Type: "Seq Scan"
        Parent Relationship: "Outer"
        Relation Name: "tt1"
        Schema: "public"
        Alias: "tt1"
        Startup Cost: 0.00
        Total Cost: 263.01
        Plan Rows: 10001
<truncated>
##################
SELECT '### '||'xml-chopped      '||title||E'\n'||
  pg_store_plans_xmlplan(substring(splan from 1 for char_length(splan) / 3))
  FROM plans WHERE id BETWEEN 22 AND 24 ORDER BY id;
### xml-chopped      ###### Plan 22: Hash Anti Join
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>Hash Join</Node-Type>
      <Join-Type>Anti</Join-Type>
      <Startup-Cost>280.02</Startup-Cost>
      <Total-Cost>693.05</Total-Cost>
      <Plan-Rows>1</Plan-Rows>
      <Plan-Width>12</Plan-Width>
      <Actual-Startup-Time>5.601</Actual-Startup-Time>
      <Actual-Total-Time>11.876</Actual-Total-Time>
      <Actual-Rows>10001</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Output>
        <Item>tt1.a</Item>
        <Item>tt1.b</Item>
        <Item>tt1.c</Item>
      </Output>
      <Hash-Cond>(tt1.a = tt2.b)</Hash-Cond>
      <Shared-Hit-Blocks>218</Shared-Hit-Blocks>
      <Shared-Read-Blocks>0</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Plan>
          <Node-Type>Seq Scan</Node-Type>
          <Parent-Relationship>Outer</Parent-Relationship>
          <Relation-Name>tt1</Relation-Name>
          <Schema>public</Schema>
          <Alias>tt1</Alias>
          <Startup-Cost>0.00</Startup-Cost>
          <Total-Cost>263.01</Total-Cost>
          <Plan-Rows>10001</Plan-Rows>
<truncated>

=======
### xml-chopped      ###### Plan 23: WindowAgg
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>WindowAgg</Node-Type>
      <Startup-Cost>927.47</Startup-Cost>
      <Total-Cost>1127.49</Total-Cost>
      <Plan-Rows>10001</Plan-Rows>
      <Plan-Width>4</Plan-Width>
      <Actual-Startup-Time>5.695</Actual-Startup-Time>
      <Actual-Total-Time>16.316</Actual-Total-Time>
      <Actual-Rows>10001</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Output>
        <Item>first_value(a) OVER (?)</Item>
        <Item>((a / 10))</Item>
      </Output>
      <Shared-Hit-Blocks>163</Shared-Hit-Blocks>
      <Shared-Read-Blocks>0</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
      <Temp-Written-Blocks>0</Temp-Written-Blocks>
      <I/O-Read-Time>0.000</I/O-Read-Time>
      <I/O-Write-Time>0.000</I/O-Write-Time>
      <Plans>
        <Plan>
          <Node-Type>Sort</Node-Type>
          <Parent-Relationship>Outer</Parent-Relationship>
<truncated>

=======
### xml-chopped      ###### Plan 24: Unique
<explain xmlns="http://www.postgresql.org/2009/explain">
  <Query>
    <Plan>
      <Node-Type>Unique</Node-Type>
      <Startup-Cost>0.29</Startup-Cost>
      <Total-Cost>785.30</Total-Cost>
      <Plan-Rows>10001</Plan-Rows>
      <Plan-Width>4</Plan-Width>
      <Actual-Startup-Time>0.010</Actual-Startup-Time>
      <Actual-Total-Time>7.693</Actual-Total-Time>
      <Actual-Rows>10001</Actual-Rows>
      <Actual-Loops>1</Actual-Loops>
      <Output>
        <Item>a</Item>
      </Output>
      <Shared-Hit-Blocks>165</Shared-Hit-Blocks>
      <Shared-Read-Blocks>0</Shared-Read-Blocks>
      <Shared-Dirtied-Blocks>0</Shared-Dirtied-Blocks>
      <Shared-Written-Blocks>0</Shared-Written-Blocks>
      <Local-Hit-Blocks>0</Local-Hit-Blocks>
      <Local-Read-Blocks>0</Local-Read-Blocks>
      <Local-Dirtied-Blocks>0</Local-Dirtied-Blocks>
      <Local-Written-Blocks>0</Local-Written-Blocks>
      <Temp-Read-Blocks>0</Temp-Read-Blocks>
<truncated>
##################
SELECT '### '||'text-chopped     '||title||E'\n'||
  pg_store_plans_textplan(substring(splan from 1 for char_length(splan) / 3))
  FROM plans WHERE id BETWEEN 25 AND 27 ORDER BY id;
### text-chopped     ###### Plan 25: PlainAggregate
Aggregate  (cost=288.01..288.02 rows=1 width=4) (actual time=3.302..3.302 rows=1 loops=1)
  Output: sum(a)
  Buffers: shared hit=163
<truncated>

=======
### text-chopped     ###### Plan 26: BitmapIndexScan/BitmapHeapScan, BitmapOr, lossy
Bitmap Heap Scan on public.tt3  (cost=4255.43..7478.44 rows=180001 width=12) (actual time=27.298..65.241 rows=180000 loops=1)
  Output: a, b, c
  Recheck Cond: (tt3.b > (-99998))
<truncated>

=======
### text-chopped     ###### Plan 27: Join Filter
Limit  (cost=0.00..21.52 rows=100 width=12) (actual time=5.307..5.431 rows=100 loops=1)
  Output: tt2.a, tt2.b, tt2.c
  Buffers: shared hit=40, temp written=12
  ->  Nested Loop  (cost=0.00..43048282.11 rows=200023334 width=12) (actual time=5.306..5.414 rows=100 loops=1)
        Output: tt2.a, tt2.b, tt2.c
<truncated>
###### shorten test
SELECT '### '||'shorten          '||title||E'\n'||
  pg_store_plans_shorten(lplan)
  FROM plans WHERE id = 0 ORDER BY id;
###### normalize test
SELECT '### '||'normalize        '||title||E'\n'||
  pg_store_plans_normalize(lplan)
  FROM plans WHERE id BETWEEN 1 AND 3 ORDER BY id;
### normalize        ###### Plan 1: Insert, Trigger
{"p":{"t":"b","!":"i","n":"tt1","s":"public","a":"tt1","l":[{"t":"o","h":"m","f":"generate_series","s":"pg_catalog","a":"a","o":["a.a","?::INTEGER","?::TEXT"]}]},"r":[{"v":"tt1_trig_1","w":"tt1"}{"v":"tt1_trig_2","w":"tt1"}]}

=======
### normalize        ###### Plan 2: Update, Trigger
{"p":{"t":"b","!":"u","n":"tt1","s":"public","a":"tt1","l":[{"t":"h","h":"m","n":"tt1","s":"public","a":"tt1","o":["(a + ?)","b","c","ctid"]}]},"r":[{"v":"tt1_trig_1","w":"tt1"}{"v":"tt1_trig_2","w":"tt1"}]}

=======
### normalize        ###### Plan 3: Delete
{"p":{"t":"b","!":"d","n":"tt1","s":"public","a":"tt1","l":[{"t":"h","h":"m","n":"tt1","s":"public","a":"tt1","o":["ctid"],"5":"((tt1.a % ?) = ?)"}]},"r":[]}
